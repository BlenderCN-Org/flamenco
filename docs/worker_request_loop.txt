# upload to https://www.websequencediagrams.com/ to visualise
title Worker Request Loop

Worker->Manager: register_worker()
Manager-->Worker: identity confirmed
Worker->Manager: get_task() [GET] /generate
note over Manager: confirm Worker as 'enabled'
Manager->Server: [GET] /scheduler/tasks
note over Server
    Pick task from queue
    Set as 'processing'
end note
Server-->Manager: task document
note over Manager
    assign task_id to Worker model
    compile task on the fly
end note
Manager-->Worker: compiled task document
note over Worker: process task
Worker->Manager: [PATCH] /tasks/<task_id>
Manager->Server: [PATCH] /task/<task_id>
Server-->Manager: 200
Manager-->Worker: 200
Worker->Manager: [GET] /tasks/zip/<task_id>
opt if task file NOT cached
    Manager->Server: [GET] /tasks/zip/<task_id>
    Server-->Manager: task_file.zip
    note over Manager: cache the file
end
Manager-->Worker: task_file.zip
