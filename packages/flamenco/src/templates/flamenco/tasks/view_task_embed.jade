.flamenco-box.task.with-status(
	class="status-{{ task.status }}")
	form#task_form(onsubmit="return false")
		input(type='hidden',name='_etag',value='{{ task._etag }}')
		.input-group
			span.item-name {{ task.name | hide_none }}

			.dropdown(style='margin-left: auto')
				button#item-dropdown.btn.btn-default.dropdown-toggle(
					type='button',
					data-toggle='dropdown',
					aria-haspopup='true', aria-expanded='true')
					i.pi-more-vertical
				ul.dropdown-menu(aria-labelledby='item-dropdown')
					li.copy-to-clipboard-id(data-clipboard-text="{{ task._id }}")
						a(href="javascript:void(0)")
							i.pi-clipboard-copy
							| Copy task ID to Clipboard
					li
						a(href="{{ url_for('flamenco.tasks.perproject.download_task_log', project_url=project.url, task_id=task._id) }}",
							target="_blank")
							i.pi-download
							| Download Task Log
		| {% if task.description %}
		p.item-description {{ task.description | hide_none }}
		| {% endif %}

		.table.item-properties
			.table-body
				.table-row
					.table-cell Belongs to job
					.table-cell
						a(
							href="{{ url_for('flamenco.jobs.perproject.view_job', project_url=project.url, job_id=task.job) }}"
							data-job-id="{{ task.job }}",
							class="job-link"
						)
							| {{ task.job }}
				.table-row
					.table-cell Job Type
					.table-cell {{ task.job_type | undertitle }}
				.table-row.properties-status.js-help(
					data-url="{{ url_for('flamenco.help', project_url=project.url) }}")
					.table-cell Status
					.table-cell(class="status-{{ task.status }}")
						| {{ task.status | undertitle }}
				.table-row
					.table-cell Priority
					.table-cell {{ task.priority }}
				//- .table-row
				//- 	.table-cell Task progress
				//- 	.table-cell {{ task.task_progress_percentage }}%
				.table-row
					.table-cell Activity
					.table-cell {{ task.activity }}
				.table-row
					.table-cell Worker
					.table-cell {{ task.worker }}

#item-view-feed
	#activities
	#comments-embed

	| {% if config.DEBUG %}
	.debug-info
		a.debug-info-toggle(role='button',
			data-toggle='collapse',
			href='#debug-content',
			aria-expanded='false',
			aria-controls='debug-content')
			i.pi-info
			| Debug Info
		#debug-content.collapse
			pre.
				{{ task.to_dict() | pprint }}
		| {% endif %}

script.
	new Clipboard('.copy-to-clipboard-id')
	.on('success', function(e) {
		statusBarSet('info', 'Copied task ID to clipboard', 'pi-check');
	});

	$('.js-help').openModalUrl('Help', "{{ url_for('flamenco.help', project_url=project.url) }}");

	setupJsJobLinkClickHandlers();

	function closeTaskDetails(){
		clearMainOverlay();

		// Push the correct URL onto the history.
		push_url = '/flamenco/{{ project.url }}/jobs/{{ task.job }}';
		var push_state = {itemId: '{{ task._id }}', itemType: 'task'};
		window.history.pushState(
						push_state,
						'task: ' + '{{ task._id }}',
						push_url
		);
	}

	$('#col_main-overlay-close').on('click', closeTaskDetails());
